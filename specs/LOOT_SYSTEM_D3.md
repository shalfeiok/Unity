# Loot / Drop-система (ориентир: Diablo III) + интеграция с UI

Дата: 2026-02-27

Цель: **полный цикл лута**: генерация → падение → отображение на земле → подсветка → фильтрация → подбор → складирование → разбор/продажа → экономика.

## 1. Типы лута
- Валюта (золото), материалы, расходники, экипировка, квестовые предметы, контейнеры наград.

## 2. Генерация предмета (Pipeline)
### 2.1 Входные параметры
- источник (mob/boss/chest/quest), уровень контента, уровень игрока/пати, сложность, тип врага (normal/elite/boss), модификаторы.

### 2.2 Редкость
- веса по источнику + бонусы (magic find/pity timer/гарантии).

### 2.3 Base item
- category/slot/требования/уровень предмета.

### 2.4 Аффиксы
- пул по слоту/классу/редкости, диапазоны роллов, число аффиксов по редкости,
- **Smart Loot**: часть аффиксов “под класс”.

### 2.5 Имя предмета на земле
- Magic/Rare: префикс + база + суффикс,
- Legendary/Set: фиксированное имя,
- локализация: таблица строк.

## 3. Падение в мир (прототип на примитивах)
- `LootDropActor`: Sphere/Cube + коллайдер.
- `LootPickup` хранит itemId, stackCount, ownerRules.
- Лёгкий “pop” физикой.

## 4. Label’ы на земле и ALT-показ
- Над предметом — TMP label (цвет по редкости).
- ALT: показать все label’ы вокруг; отпускание — вернуть стандартное поведение.
- Группировка: валюта/материалы объединяются в один label (опционально).

## 5. Подсветка (Highlight) и фильтр
- Прототип: смена материала/цвета примитива + усиление label.
- Фильтр:
  - минимум по редкости,
  - категории (оружие/броня/материалы),
  - скрывать “junk”.

## 6. Подбор
- ручной подбор по кнопке, автоподбор валюты/материалов,
- проверка места, toast уведомления, запись в журнал.

## 7. UI-интеграция
- toast “Получено: …”
- сравнение в инвентаре
- метки New/Junk/Locked

## 8. Тесты
### EditMode
- детерминизм генерации при seed,
- диапазоны роллов,
- соответствие редкости и числа аффиксов,
- генерация имени по шаблону.

### PlayMode
- spawn actor + label,
- ALT toggle,
- фильтр скрывает/показывает,
- pickup переносит в инвентарь и удаляет actor.

## 9. Acceptance criteria
- 1000 генераций с фикс seed повторяемы,
- labels/ALT/подсветка/фильтр/подбор работают.
